<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1"><!-- maximum-scale=1, user-scalable=no -->
        <title>Fancy Random Name Generator</title>
        <link href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
        <link href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.3.5/bootstrap-select.min.css" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
        <style>
            body {
                margin: 1em;
                color: #333;
                background-color: #ccc;
                font-family: "Open Sans", sans-serif;;
                font-size: 11pt;
            }
            span.col-md-5 {
                padding: 1em;
                background-color: #fff;
                -webkit-box-shadow: 2px 2px 2px rgba(0,0,0,.25);
                -moz-box-shadow: 2px 2px 2px rgba(0,0,0,.25);
                box-shadow: 2px 2px 2px rgba(0,0,0,.25);
            }
            span.col-md-5:not(:first-child) {
                margin-left: 1em;
            }
            h2 {
                display: inline-block;
                text-decoration: underline;
                margin: 0 15px 8px 0;
            }
            h2 + span > .btn {
                margin-bottom: 10px;
            }
            input.form-control {
                display: inline-block;
            }
            input[type="text"] {
                height: 24px;
                padding: 1px 3px;
            }
            /*li:nth-child(even) {
                background-color: #eee;
            }*/
            
            .start-hidden {
                display: none;
            }
            
            .row:not(:first-child) {
                margin-top: 20px;
            }
            
            #seed-names {
                height: 200px;
                width: 400px;
            }
            #amount,
            #min-count,
            #min-inner {
                width: 40px;
            }
            #clear-keepers,
            #clear-results {
                /*font-size: 9pt;
                margin-left: 15px;*/
            }
        </style>
    </head>
    <body>
        <form class="container">
            <div class="row">
                <span id="names-block" class="col-md-5">
                    <div>
                        <h2>Seed Names</h2>
                        <select id="presets" name="presets" class="selectpicker" data-style="btn-default btn-xs" data-width="180px" data-show-subtext="true">
                            <option value="default">Presets</option>
                            <optgroup label="English">
                                <option value="en-male" data-subtext="English">Male</option>
                                <option value="en-female" data-subtext="English">Female</option>
                            </optgroup>
                            <optgroup label="Middle-earth">
                                <option value="me-hobbits" data-subtext="Middle-earth">Hobbits</option>
                                <option value="me-men" data-subtext="Middle-earth">Men</option>
                                <option value="me-dwarves" data-subtext="Middle-earth">Dwarves</option>
                                <option value="me-elves" data-subtext="Middle-earth">Elves</option>
                                <option value="me-various" data-subtext="Middle-earth">Various</option>
                            </optgroup>
                            <optgroup label="Game of Thrones">
                                <option value="got-male" data-subtext="Game of Thrones">Male</option>
                                <option value="got-female" data-subtext="Game of Thrones">Female</option>
                            </optgroup>
                            <optgroup label="Harry Potter">
                                <option value="hp-male" data-subtext="Harry Potter">Male</option>
                                <option value="hp-female" data-subtext="Harry Potter">Female</option>
                            </optgroup>
                        </select>
                    </div>
                    <div>
                        <textarea id="seed-names" name="seed-names" class="form-control"></textarea>
                    </div>
                </span>
                <span id="seed-options-block" class="col-md-5">
                    <div>
                        <h2>Options</h2>
                        <span>
                            <button id="reset-all" type="reset" class="btn btn-danger btn-xs">
                                <span class="glyphicon glyphicon-repeat"></span> Reset All
                            </button>
                        </span>
                    </div>
                    <div>
                        <input id="min-count" name="min-count" type="text" value="1" class="form-control"/>
                        <label for="min-count">Minimum chunk count</label>
                    </div>
                </span>
            </div>
            <div class="row">
                <span id="chunks-block" class="col-md-5">
                    <div>
                        <h2>Chunks</h2>
                        <span>
                            <button id="load-chunks" type="button" class="btn btn-primary btn-xs">
                                <span class="glyphicon glyphicon-arrow-down"></span> Add Chunks
                            </button>
                            <button id="clear-results" type="button" class="btn btn-default btn-xs" disabled>
                                <span class="glyphicon glyphicon-remove"></span> Clear
                            </button>
                        </span>
                    </div>
                    <div></div>
                </span>
                <span id="chunk-options-block" class="col-md-5">
                    <div>
                        <input id="amount" name="amount" type="text" value="10" class="form-control"/>
                        <label for="amount">Amount to generate</label>
                    </div>
                    <div>
                        <input id="min-inner" name="min-inner" type="text" value="0" class="form-control"/>
                        <label for="min-inner">Minimum inner chunks</label>
                    </div>
                </span>
            </div>
            <div class="row">
                <span id="results-block" class="col-md-5">
                    <div>
                        <h2>Results</h2>
                        <span>
                            <button id="generate" type="button" class="btn btn-primary btn-xs">
                                <span class="glyphicon glyphicon-arrow-down"></span> Generate
                            </button>
                            <button id="clear-results" type="button" class="btn btn-default btn-xs" disabled>
                                <span class="glyphicon glyphicon-remove"></span> Clear
                            </button>
                        </span>
                    </div>
                    <div id="results"></div>
                    <div id="message"></div>
                </span>
                <span id="keepers-block" class="col-md-5" style="display: none;">
                    <div>
                        <h2>Keepers</h2>
                        <button id="clear-keepers" type="button" class="btn btn-default btn-xs" disabled>
                            <span class="glyphicon glyphicon-remove"></span> Clear
                        </button>
                    </div>
                    <div id="keepers"></div>
                </span>
            </div>
        </form>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" type="text/javascript"></script>
        <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.3.5/bootstrap-select.min.js" type="text/javascript"></script>
        <script type="text/javascript">

            // A big ol' block o' names
            presets = {
                "default": "Alex Bobby Charlie Doug Edward Francis Gabriel Harold Ian James Kevin Larry Michael Nathan Oswald Peter Quincy Romeo Stephen Travis Usher Victor William Xavier Yancy Zack",
                "en-male": "english men",
                "en-female": "english women",
                "me-hobbits": "me hobbits",
                "me-men": "me men",
                "me-dwarves": "me dorfs",
                "me-elves": "me elfmans",
                "me-various": "me mixed",
                "got-male": "got dudes?",
                "got-female": "got dames?",
                "hp-male": "hp boys",
                "hp-female": "hp ladiez",
            }

            // Because JavaScript doesn't have this??
            function random_int(min, max) {
                return Math.floor(Math.random() * (max - min + 1) + min);
            }

            // Next two functions are mostly adapted from the blog post
            //  "Random Name Generation" by Jim Storch
            //  http://bogboa.blogspot.com/2009/12/random-name-generation.html
            //  (it's nicer in Python)
            function get_chunks(name) {
                var lead = /^[aeiouy]*(?:qu|[bcdfghjklmnpqrstvwxz])+/;
                var inner = /\B[aeiouy]+(?:qu|[bcdfghjklmnpqrstvwxz])+\B/g;
                var tail = /[aeiouy]+(?:qu|[bcdfghjklmnpqrstvwxz])*$/;
                name = name.toLowerCase();
                return [name.match(lead), name.match(inner), name.match(tail)];
            }

            function make_names(seed_names, amount, minimum_count, minimum_inner) {
                amount = typeof amount != 'undefined' ? amount : 10;
                minimum_count = typeof minimum_count != 'undefined' ? minimum_count : 1;
                minimum_inner = typeof minimum_inner != 'undefined' ? minimum_inner : 0;
                if (seed_names.length < 1) {
                    return [];
                }
                // Build our lists of usable chunks first.
                var lead_chunks = {}, inner_chunks = {}, tail_chunks = {};
                $.each(seed_names, function(index, name) {
                    var chunk;
                    var chunks = get_chunks(name);
                    if (chunks[0]) {
                        chunk = chunks[0][0];
                        lead_chunks[chunk] = (lead_chunks[chunk] || 0) + 1;
                    }
                    if (chunks[1]) {
                        $.each(chunks[1], function(index, chunk) {
                            inner_chunks[chunk] = (inner_chunks[chunk] || 0) + 1;
                        });
                    }
                    if (chunks[2]) {
                        chunk = chunks[2][0];
                        tail_chunks[chunk] = (tail_chunks[chunk] || 0) + 1;
                    }
                });
                var leads = [], inners = [], tails = [];
                $.each(lead_chunks, function(chunk, count) {
                    if (count >= minimum_count) {
                        leads.push(chunk)
                    }
                });
                $.each(inner_chunks, function(chunk, count) {
                    if (count >= minimum_count) {
                        inners.push(chunk)
                    }
                });
                $.each(tail_chunks, function(chunk, count) {
                    if (count >= minimum_count) {
                        tails.push(chunk)
                    }
                });
                if (leads.length < 1 || inners.length < 1 || tails.length < 1) {
                    return [];
                }
                // We've got our lists, now we can build us some names!
                var names = [];
                for (var i = 0; i < amount; i++) {
                    var random_inners = Number(minimum_inner) + random_int(0, 1);
                    if (Math.random() > 0.85) {
                        random_inners += 1;
                    }
                    var name = leads[random_int(0, leads.length - 1)];
                    for (var j = 0; j < random_inners; j++) {
                        name += inners[random_int(0, inners.length - 1)];
                    }
                    name += tails[random_int(0, tails.length - 1)];
                    name = name.charAt(0).toUpperCase() + name.slice(1);
                    names.push(name);
                }
                return names;
            }

            // Form processing stuff
            function change_preset(event) {
                var names = presets[$(this).val()];
                if (names != "") {
                    $("#seed-names").val(names);
                }
            }
            
            function click_reset_all(event) {
                $("#presets").selectpicker("val", "default");
                $("#seed-names").delay(100).val(presets["default"]);
            }
            
            function click_generate(event) {
                var amount = Number($("#amount").val());
                var minimum_count = Number($("#min-count").val());
                var minimum_inner = Number($("#min-inner").val());
                // "amount" and "minimum_count" could be NaN from the
                //  Number conversion, so we're wrapping this in a NOT,
                //  because NaN < 0 returns false.
                if (!(amount >= 1)) {
                    // todo: some sort of error message/color
                    return;
                }
                if (!(minimum_count >= 0)) {
                    // todo: some sort of error message/color
                    return;
                }
                if (!(minimum_inner >= 0)) {
                    // todo: some sort of error message/color
                    return;
                }
                var seed_names = $("#seed-names").val()
                                                 .replace(/[\t\n\r]/g, " ")
                                                 .replace(/ +/g, " ");
                seed_names = $.trim(seed_names).split(" ");
                if (seed_names.length < 1 || seed_names[0] == "") {
                    return;
                }
                var new_names = make_names(seed_names, amount, minimum_count, minimum_inner);
                new_names = new_names.join(" ");
                
                // todo: filtering duplicate names
                prev_names = $("#results").text()
                if (prev_names) {
                    prev_names += " ";
                }
                $("#results").text(prev_names + new_names);
                
                //$("#message").text("a message");
                $("#clear-results").attr("disabled", false);
            }

            function click_clear_results(event) {
                $("#results").text("");
                $("#message").text("");
                $(this).attr("disabled", true);
            }

            function click_clear_keepers(event) {
                $("#keepers").text("");
                $(this).attr("disabled", true);
            }

            $(document).ready(function() {
                $("#presets")
                    .on("change", change_preset)
                    .selectpicker()
                    .trigger("change");
                $("#reset-all").on("click", click_reset_all);
                $("#generate").on("click", click_generate);
                $("#clear-results").on("click", click_clear_results);
                $("#clear-keepers").on("click", click_clear_keepers);
            });
        </script>
    </body>
</html>
