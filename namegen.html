<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1"><!-- maximum-scale=1, user-scalable=no -->
        <title>Fancy Random Name Generator</title>
        <link href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
        <link href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
        <style>
            body, input, textarea {
                font-family: "Open Sans", sans-serif;;
                font-size: 11pt;
            }
            h2 {
                display: inline-block;
                text-decoration: underline;
                margin: 0 0 8px 0;
            }
            
            .row:not(:first-child) {
                margin-top: 20px;
            }
            
            #presets {
                margin-left: 15px;
                width: 160px;
            }
            #seed-names {
                height: 200px;
                width: 300px;
            }
            #amount,
            #min-count {
                width: 40px;
            }
            #clear-keepers,
            #clear-results {
                /*font-size: 9pt;
                margin-left: 15px;*/
            }
        </style>
    </head>
    <body>
        <form class="container">
            <div class="row">
                <span id="names-block" class="col-md-5">
                    <div>
                        <h2>Seed Names</h2>
                        <!--
                        <div class="dropdown">
                            <button class="btn dropdown-toggle sr-only" type="button" id="dropdownMenu1" data-toggle="dropdown">
                                <span class="caret"></span> Presets
                            </button>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                                <li role="presentation"><a role="menuitem" tabindex="-1" href="#" data-value="en-male">English Male</a></li>
                                <li role="presentation"><a role="menuitem" tabindex="-1" href="#" data-value="en-female">English Female</a></li>
                                <li role="presentation" class="divider"></li>
                                <li role="presentation"><a role="menuitem" tabindex="-1" href="#" data-value="me-hobbits">Middle-earth Hobbits</a></li>
                                <li role="presentation"><a role="menuitem" tabindex="-1" href="#" data-value="me-men">Middle-earth Men</a></li>
                                <li role="presentation"><a role="menuitem" tabindex="-1" href="#" data-value="me-dwarves">Middle-earth Dwarves</a></li>
                                <li role="presentation"><a role="menuitem" tabindex="-1" href="#" data-value="me-elves">Middle-earth Elves</a></li>
                                <li role="presentation"><a role="menuitem" tabindex="-1" href="#" data-value="me-various">Middle-earth Various</a></li>
                                <li role="presentation" class="divider"></li>
                                <li role="presentation"><a role="menuitem" tabindex="-1" href="#" data-value="got-male">Game of Thrones Male</a></li>
                                <li role="presentation"><a role="menuitem" tabindex="-1" href="#" data-value="got-female">Game of Thrones Female</a></li>
                                <li role="presentation" class="divider"></li>
                                <li role="presentation"><a role="menuitem" tabindex="-1" href="#" data-value="hp-male">Harry Potter Male</a></li>
                                <li role="presentation"><a role="menuitem" tabindex="-1" href="#" data-value="hp-female">Harry Potter Female</a></li>
                            </ul>
                        </div>
                        -->
                        <select id="presets" name="presets" class="form-control">
                            <option value="">Presets</option>
                            <option value="">---------</option>
                            <option value="en-male">English Male</option>
                            <option value="en-female">English Female</option>
                            <option value="me-hobbits">Middle-earth Hobbits</option>
                            <option value="me-men">Middle-earth Men</option>
                            <option value="me-dwarves">Middle-earth Dwarves</option>
                            <option value="me-elves">Middle-earth Elves</option>
                            <option value="me-various">Middle-earth Various</option>
                            <option value="got-male">Game of Thrones Male</option>
                            <option value="got-female">Game of Thrones Female</option>
                            <option value="hp-male">Harry Potter Male</option>
                            <option value="hp-female">Harry Pottery Female</option>
                        </select>
                    </div>
                    <div>
                        <textarea id="seed-names" name="seed-names" class="form-control">Alex Bobby Charlie Doug Edward Francis Gabriel Harold Ian James Kevin Larry Michael Nathan Oswald Peter Quincy Romeo Stephen Travis Usher Victor William Xavier Yancy Zack</textarea>
                    </div>
                </span>
                <span id="seed-options-block" class="col-md-5">
                    <div>
                        <h2>Options</h2>
                        <button id="reset" type="reset" class="btn btn-danger btn-sm">
                            <span class="glyphicon glyphicon-repeat"></span> Reset All
                        </button>
                    </div>
                    <div>
                        <input id="min-count" name="min-count" type="text" value="0" class="form-control"/>
                        <label for="min-count">Minimum chunk count</label>
                    </div>
                    <div>
                        
                    </div>
                    <!-- todo: "keeper" box on right, name presets box above seed names, "Options" above options to level, clickable names via <a> to add to keepers -->
                </span>
            </div>
            <div class="row">
                <span id="chunks-block" class="col-md-5">
                    <div>
                        <h2>Chunks</h2>
                        <button id="load-chunks" type="button" class="btn btn-primary btn-sm">
                            <span class="glyphicon glyphicon-arrow-down"></span> Add Chunks
                        </button>
                        <button id="clear-results" type="button" class="btn btn-default btn-sm" disabled>
                            <span class="glyphicon glyphicon-remove"></span> Clear
                        </button>
                    </div>
                    <div></div>
                </span>
                <span id="chunk-options-block" class="col-md-5">
                    <div>
                        <input id="amount" name="amount" type="text" value="10" class="form-control"/>
                        <label for="amount">Amount to generate</label>
                    </div>
                    <div>
                        <input id="allow-short" type="checkbox" checked/>
                        <label for="allow-short">Allow short</label>
                    </div>
                    <!-- todo: "keeper" box on right, name presets box above seed names, "Options" above options to level, clickable names via <a> to add to keepers -->
                </span>
            </div>
            <div class="row">
                <span id="results-block" class="col-md-5">
                    <div>
                        <h2>Results</h2>
                        <button id="generate" type="button" class="btn btn-primary btn-sm" disabled>
                            <span class="glyphicon glyphicon-arrow-down"></span> Generate
                        </button>
                        <button id="clear-results" type="button" class="btn btn-default btn-sm" disabled>
                            <span class="glyphicon glyphicon-remove"></span> Clear
                        </button>
                    </div>
                    <div id="results"></div>
                    <div id="message"></div>
                </span>
                <span id="keepers-block" class="col-md-5" style="display: none;">
                    <div>
                        <h2>Keepers</h2>
                        <button id="clear-keepers" type="button" class="btn btn-default btn-sm" disabled>
                            <span class="glyphicon glyphicon-remove"></span> Clear
                        </button>
                    </div>
                    <div id="keepers"></div>
                </span>
            </div>
        </form>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" type="text/javascript"></script>
        <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js" type="text/javascript"></script>
        <script type="text/javascript">

            // A big ol' block o' names
            presets = {
                "en-male": "english men",
                "en-female": "english women",
                "me-hobbits": "me hobbits",
                "me-men": "me men",
                "me-dwarves": "me dorfs",
                "me-elves": "me elfmans",
                "me-various": "me mixed",
                "got-male": "got dudes?",
                "got-female": "got dames?",
                "hp-male": "hp boys",
                "hp-female": "hp ladiez",
            }

            // Because JavaScript doesn't have this??
            function random_int(min, max) {
                return Math.floor(Math.random() * (max - min + 1) + min);
            }

            // Next two functions are mostly adapted from the blog post
            //  "Random Name Generation" by Jim Storch
            //  http://bogboa.blogspot.com/2009/12/random-name-generation.html
            //  (it's nicer in Python)
            function get_chunks(name) {
                var lead = /^[aeiouy]*(?:qu|[bcdfghjklmnpqrstvwxz])+/;
                var inner = /\B[aeiouy]+(?:qu|[bcdfghjklmnpqrstvwxz])+\B/g;
                var tail = /[aeiouy]+(?:qu|[bcdfghjklmnpqrstvwxz])*$/;
                name = name.toLowerCase();
                return [name.match(lead), name.match(inner), name.match(tail)];
            }

            function make_names(seed_names, amount, minimum_count, allow_short) {
                amount = typeof amount != 'undefined' ? amount : 10;
                minimum_count = typeof minimum_count != 'undefined' ? minimum_count : 0;
                allow_short = typeof allow_short != 'undefined' ? allow_short : true;
                if (seed_names.length < 1) {
                    return [];
                }
                // Build our lists of usable chunks first.
                var lead_chunks = {}, inner_chunks = {}, tail_chunks = {};
                $.each(seed_names, function(index, name) {
                    var chunk;
                    var chunks = get_chunks(name);
                    if (chunks[0]) {
                        chunk = chunks[0][0];
                        lead_chunks[chunk] = (lead_chunks[chunk] || 0) + 1;
                    }
                    if (chunks[1]) {
                        $.each(chunks[1], function(index, chunk) {
                            inner_chunks[chunk] = (inner_chunks[chunk] || 0) + 1;
                        });
                    }
                    if (chunks[2]) {
                        chunk = chunks[2][0];
                        tail_chunks[chunk] = (tail_chunks[chunk] || 0) + 1;
                    }
                });
                var leads = [], inners = [], tails = [];
                $.each(lead_chunks, function(chunk, count) {
                    if (count >= minimum_count) {
                        leads.push(chunk)
                    }
                });
                $.each(inner_chunks, function(chunk, count) {
                    if (count >= minimum_count) {
                        inners.push(chunk)
                    }
                });
                $.each(tail_chunks, function(chunk, count) {
                    if (count >= minimum_count) {
                        tails.push(chunk)
                    }
                });
                if (leads.length < 1 || inners.length < 1 || tails.length < 1) {
                    return [];
                }
                // We've got our lists, now we can build us some names!
                var names = [];
                for (var i = 0; i < amount; i++) {
                    var random_inners = random_int(0, 1)
                    random_inners += Number(!allow_short)
                    if (Math.random() > 0.85) {
                        random_inners += 1
                    }
                    var name = leads[random_int(0, leads.length - 1)];
                    for (var j = 0; j < random_inners; j++) {
                        name += inners[random_int(0, inners.length - 1)];
                    }
                    name += tails[random_int(0, tails.length - 1)];
                    name = name.charAt(0).toUpperCase() + name.slice(1);
                    names.push(name);
                }
                return names;
            }

            // Form processing stuff
            function change_preset(event) {
                var names = presets[$(this).val()];
                if (names != "") {
                    $("#seed-names").val(names);
                }
            }

            function click_generate(event) {
                var amount = Number($("#amount").val());
                var minimum_count = Number($("#min-count").val());
                var allow_short = $("#allow-short").is(":checked");
                // "amount" and "minimum_count" could be NaN from the
                //  Number conversion, so we're wrapping this in a NOT,
                //  because NaN < 0 returns false.
                if (!(amount >= 1)) {
                    // todo: some sort of error message/color
                    return;
                }
                if (!(minimum_count >= 0)) {
                    // todo: some sort of error message/color
                    return;
                }
                var seed_names = $("#seed-names").val()
                                                 .replace(/[\t\n\r]/g, " ")
                                                 .replace(/ +/g, " ")
                seed_names = $.trim(seed_names).split(" ");
                if (seed_names.length < 1 || seed_names[0] == "") {
                    return;
                }
                var new_names = make_names(seed_names, amount, minimum_count, allow_short);
                new_names = new_names.join(" ");
                
                // todo: filtering duplicate names
                prev_names = $("#results").text()
                if (prev_names) {
                    prev_names += " ";
                }
                $("#results").text(prev_names + new_names);
                
                //$("#message").text("a message");
                $("#clear-results").attr("disabled", false);
            }

            function click_clear_results(event) {
                $("#results").text("");
                $("#message").text("");
                $(this).attr("disabled", true);
            }

            function click_clear_keepers(event) {
                $("#keepers").text("");
                $(this).attr("disabled", true);
            }

            $(document).ready(function() {
                $("#presets").on("change", change_preset);
                $("#generate").on("click", click_generate);
                $("#clear-results").on("click", click_clear_results);
                $("#clear-keepers").on("click", click_clear_keepers);
            });
        </script>
    </body>
</html>
